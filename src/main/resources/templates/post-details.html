<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${post.title}">Post Title</title>
    <meta charset="UTF-8"/>
</head>
<body style="content-allign: centre;">

<div th:if="${!editPost}" style="border: 1px solid #ccc; padding: 15px; margin-bottom: 20px;">
    <h1 th:text="${post.title}">Post Title</h1>

    <p><i>By <b><span th:text="${post.author}">Author Name</span></b></i></p>

    <div class="published-time" th:if="${post.publishedAt != null}"
         th:text="'Published on: ' + ${#temporals.format(post.publishedAt, 'dd MMM yyyy HH:mm')}">
    </div>


    <p><strong>Content:</strong></p>
    <p th:text="${post.content}">Post content goes here...</p>


    <div th:if="${!editPost} and ${post.tags != null and !post.tags.isEmpty()}">
        <h3>Tags:</h3>
        <span th:each="tag : ${post.tags}" style="margin-right: 5px;">
                <span th:text="'#' + ${tag.name}"></span>
            </span>
    </div>
    <br/><br/>

    <button th:onclick="'location.href=\'/posts/update/' + ${post.id} + '\';'">Edit Post</button>
</div>

<div th:if="${editPost}">
    <form th:action="@{'/posts/update/' + ${post.id}}" th:object="${post}" method="post">

        <label>Title:</label><br/>
        <input type="text" th:field="*{title}" required/><br/><br/>

        <label>Tags (comma separated):</label><br/>
        <input type="text"
               name="tagAssister"
               th:value="${#strings.arrayJoin(post.tags.![name], ', ')}"
               placeholder="e.g. java, springboot, backend"/><br/><br/>

        <label>Content:</label><br/>
        <textarea th:field="*{content}" rows="6" required></textarea><br/><br/>

        <button type="submit">Save Post</button>
        <button type="button" th:onclick="'location.href=\'/posts/' + ${post.id} + '\';'">Cancel</button>
    </form>
</div>


<div style="border: 1px solid #ccc; padding: 15px; margin-bottom: 20px;">
    <h3>Comments:</h3>

    <div th:if="${post.comments == null or post.comments.isEmpty()}">
        <p>No comments yet.</p>
    </div>

    <div th:each="comment : ${post.comments}" style="border: 1px solid #ccc; padding: 15px; margin-bottom: 20px;">
        <!-- Display mode for comment -->
        <div th:if="${editCommentId == null or editCommentId != comment.id}">
            <p>
                <strong th:text="${comment.name}">Commenter Name</strong>
                (<span th:text="${comment.email}">email@example.com</span>)
            </p>
            <p th:text="${comment.comment}">Comment text goes here...</p>
            <p>
                <small th:text="${#temporals.format(comment.createdAt, 'dd MMM yyyy HH:mm')}">
                    Comment date
                </small>
                <button th:onclick="'location.href=\'/comments/update/' + ${comment.id} + '\';'">Edit Comment</button>
            </p>

            <form th:action="@{'/comments/delete/' + ${comment.id}}" method="post" style="display:inline;">
                <button type="submit" onclick="return confirm('Are you sure you want to delete this comment?');">Delete</button>
            </form>
            <hr/>

        </div>


        <div th:if="${editCommentId != null and editCommentId == comment.id}">
            <form th:action="@{'/comments/update/' + ${comment.id}}" th:object="${comment}" method="post">
                <label>Name:</label><br/>
                <input type="text" th:field="*{name}" required/><br/><br/>

                <label>Email:</label><br/>
                <input type="email" th:field="*{email}" required/><br/><br/>

                <label>Comment:</label><br/>
                <textarea th:field="*{comment}" rows="4" required></textarea><br/><br/>

                <button type="submit">Save Comment</button>
                <button type="button" th:onclick="'location.href=\'/posts/' + ${post.id} + '\';'">Cancel</button>
            </form>
        </div>
    </div>
</div>


<div>
    <h3>Leave a Comment:</h3>

    <form th:action="@{'/comments/add/' + ${post.id}}" th:object="${userComment}" method="post">

        <label for="name">Name:</label><br/>
        <input type="text" id="name" th:field="*{name}" required/><br/><br/>

        <label for="email">Email:</label><br/>
        <input type="email" id="email" th:field="*{email}" required/><br/><br/>

        <label for="comment">Comment:</label><br/>
        <textarea id="comment" th:field="*{comment}" rows="4" required></textarea><br/><br/>

        <button type="submit">Submit Comment</button>
    </form>
</div>

<p><a th:href="@{/posts}">‚Üê Back to all posts</a></p>

</body>
</html>
