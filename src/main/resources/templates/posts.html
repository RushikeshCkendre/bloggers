<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>All Posts</title>

    <form th:action="@{/posts/filter}" method="get" style="margin-bottom: 1em;">
        <input type="text" name="keyword" placeholder="Search posts..." th:value="${keyword}" />

            <button type="submit">Search</button>


        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 0.75rem;">
            <strong>Tags:</strong>
            <div th:each="tag : ${alltags}" style="display: flex; align-items: center;">
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="checkbox" name="tags" th:value="${tag.name}" />
                    <span th:text="${tag.name}">Tag</span>
                </label>
            </div>
        </div>
        <br/><br/>

        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 0.75rem;">
        <strong>Authors:</strong>
        <div th:each="author : ${allauthors}" style="display: flex; align-items: center;">
            <label style="display: flex; align-items: center; gap: 4px;">
                <input type="checkbox" name="authors" th:value="${author}" />
                <span th:text="${author}">Author</span>
            </label>
        </div>
    </div>
        <br/><br/>



    </form>
    <br/><br/>
</head>
<body>
<a th:href="@{/posts/new}" class="btn btn-primary" style="margin-bottom: 1em; display: inline-block;">
    Create New Post
</a>
<h1>All Blog Posts</h1>

<div th:if="${#lists.isEmpty(allposts)}">
    <p>No posts found.</p>
</div>

<div th:each="post : ${allposts}">
    <div style="border: 1px solid #ccc; padding: 10px; margin: 10px;">
        <a th:href="@{'/posts/' + ${post.id}}">
            <h2 th:text="${post.title}"></h2>
        </a>
        <p th:text="${post.excerpt}"></p>

        <div th:if="${post.tags != null}">
            <strong>Tags:</strong>
            <span th:each="tag : ${post.tags}" style="margin-right: 5px;">
                <span th:text="'#' + ${tag.name}"></span>
            </span>
        </div>
    </div>
</div>


<div>
    <ul class="pagination" style="list-style: none; display: flex; gap: 0.5em; padding: 0;">
        <li th:classappend="${allposts.hasPrevious()} ? '' : 'disabled'" style="padding: 0 10px; border: 1px solid #ccc; cursor: pointer;">
            <a th:if="${allposts.hasPrevious()}" th:href="@{|/posts?page=${allposts.number - 1}&keyword=${keyword}|}" aria-label="Previous">Prev</a>
            <span th:unless="${allposts.hasPrevious()}" style="color: gray; cursor: default;">Previous page</span>
        </li>


        <li th:each="pageNum : ${#numbers.sequence(0, allposts.totalPages - 1)}"
            th:classappend="${pageNum == allposts.number} ? 'active'"
            style="padding: 0 10px; border: 1px solid #ccc; cursor: pointer;">
            <a th:href="@{|/posts?page=${pageNum}&keyword=${keyword}|}" th:text="${pageNum + 1}">1</a>
        </li>

        <li th:classappend="${allposts.hasNext()} ? '' : 'disabled'" style="padding: 0 10px; border: 1px solid #ccc; cursor: pointer;">
            <a th:if="${allposts.hasNext()}" th:href="@{|/posts?page=${allposts.number + 1}&keyword=${keyword}|}" aria-label="Next">Next</a>
            <span th:unless="${allposts.hasNext()}" style="color: gray; cursor: default;">Next</span>
        </li>
    </ul>
</div>

</body>
</html>
